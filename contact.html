<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact - Consider Restoration</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="js/logger.js"></script>
    <script src="js/portal-session-manager.js"></script>
    <script src="js/shared-data.js"></script>
    <!-- DISABLED old session managers -->
    <!-- <script src="js/cookie-session-manager.js"></script> -->
    <!-- <script src="js/navigation-handler.js"></script> -->
    <!-- No external dependencies needed for backend submission -->
</head>
<body>
    <header>
        <nav class="navbar">
            <div class="nav-container">
                <h1 class="logo">Consider Restoration</h1>
                <ul class="nav-menu">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="about.html">About</a></li>
                    <li><a href="services.html">Services</a></li>
                    <li><a href="membership.html">Membership</a></li>
                    <li><a href="booking.html">Book Appointment</a></li>
                    <li><a href="reviews.html">Reviews</a></li>
                    <li><a href="contact.html" class="active">Contact</a></li>
                    <li><a href="user-portal.html" id="accountNavLink">Login</a></li>
                    <li id="adminNavLink" style="display: none;"><a href="admin.html">Admin</a></li>
                </ul>
            </div>
        </nav>
    </header>

    <main>
        <section class="contact page-section">
            <div class="container">
                <h1>Contact Information</h1>
                <div class="contact-content">
                    <div class="contact-info">
                        <div class="contact-item">
                            <h3>üìç Location</h3>
                            <p><strong>Address:</strong> 32788 Five Mile Rd, Livonia, MI 48152</p>
                        </div>
                        
                        <div class="contact-item">
                            <h3>üìû Phone</h3>
                            <p><strong>Phone:</strong> <a href="tel:7344194116">(734) 419-4116</a></p>
                        </div>
                        
                        <div class="contact-item">
                            <h3>‚úâÔ∏è Email</h3>
                            <p><strong>Email:</strong> <a href="mailto:considerrestoration@gmail.com">considerrestoration@gmail.com</a></p>
                        </div>
                        
                        <div class="hours-section">
                            <h3>üïí Business Hours</h3>
                            <ul class="hours-list">
                                <li><strong>Monday:</strong> 10:00 AM - 4:00 PM</li>
                                <li><strong>Tuesday:</strong> By appointment only</li>
                                <li><strong>Wednesday:</strong> 9:45 AM - 5:30 PM</li>
                                <li><strong>Thursday:</strong> 12:00 PM - 7:00 PM</li>
                                <li><strong>Friday:</strong> 10:00 AM - 6:00 PM</li>
                                <li><strong>Saturday/Sunday:</strong> Closed</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="contact-form-section">
                        <h2>Send a Message</h2>
                        <form id="contactForm" class="contact-form">
                            <div class="form-group">
                                <label for="contactName">Full Name:</label>
                                <input type="text" id="contactName" name="name" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="contactEmail">Email:</label>
                                <input type="email" id="contactEmail" name="email" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="contactPhone">Phone (optional):</label>
                                <input type="tel" id="contactPhone" name="phone">
                            </div>
                            
                            <div class="form-group">
                                <label for="contactSubject">Subject:</label>
                                <select id="contactSubject" name="subject" required>
                                    <option value="">Select a subject</option>
                                    <option value="appointment">Appointment Question</option>
                                    <option value="services">Services Information</option>
                                    <option value="membership">Membership Program</option>
                                    <option value="gift-certificate">Gift Certificates</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="contactMessage">Message:</label>
                                <textarea id="contactMessage" name="message" rows="5" required></textarea>
                            </div>
                            
                            <button type="submit" class="submit-button">Send Message</button>
                        </form>
                    </div>
                </div>
                
                <div class="additional-info">
                    <div class="info-card">
                        <h3>üéÅ Gift Certificates</h3>
                        <p>Perfect for holidays, birthdays, or any special occasion. Gift certificates are available for all services and can be purchased online or by phone.</p>
                    </div>
                    
                    <div class="info-card">
                        <h3>üöó Parking & Access</h3>
                        <p>Free parking available on-site. The practice is wheelchair accessible with easy ground-level entry.</p>
                    </div>
                    
                    <div class="info-card">
                        <h3>üìã First-Time Clients</h3>
                        <p>Please arrive 15 minutes early for intake forms. Bring a list of any medications and areas of concern you'd like addressed.</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2024 Consider Restoration - Christopher Rembisz, LMT. All rights reserved.</p>
        </div>
    </footer>

    <script src="js/script.js"></script>
    <script>
        // Check for logged-in user and auto-populate contact form
        function checkUserSessionForContact() {
            console.log('üìß Checking user session for contact form auto-population...');
            
            let currentUser = null;
            
            // Try universal session manager first (main system)
            if (window.universalSession) {
                currentUser = window.universalSession.getCurrentUser();
                console.log('üìß Using universalSession:', currentUser ? `${currentUser.name} (${currentUser.email})` : 'No user');
            }
            // Fallback to direct localStorage check
            else {
                const userSession = localStorage.getItem('user_session_data');
                if (userSession) {
                    try {
                        currentUser = JSON.parse(userSession);
                        console.log('üìß Using localStorage fallback:', currentUser ? `${currentUser.name} (${currentUser.email})` : 'No user');
                    } catch (e) {
                        console.warn('üìß Invalid session data in localStorage');
                    }
                }
            }
            
            const nameField = document.getElementById('contactName');
            const emailField = document.getElementById('contactEmail');
            const phoneField = document.getElementById('contactPhone');
            
            if (currentUser) {
                console.log('‚úÖ User session found, auto-populating contact fields for:', currentUser.name);
                
                // Auto-fill user info if user is logged in
                if (nameField && !nameField.value) {
                    nameField.value = currentUser.name || '';
                    nameField.style.backgroundColor = '#f0f8ff'; // Light blue to show pre-filled
                    nameField.style.border = '2px solid #27ae60'; // Green border for auto-filled
                    console.log('üìß Populated name field:', currentUser.name);
                }
                if (emailField && !emailField.value) {
                    emailField.value = currentUser.email || '';
                    emailField.style.backgroundColor = '#f0f8ff';
                    emailField.style.border = '2px solid #27ae60';
                    console.log('üìß Populated email field:', currentUser.email);
                }
                if (phoneField && !phoneField.value && currentUser.phone) {
                    phoneField.value = currentUser.phone;
                    phoneField.style.backgroundColor = '#f0f8ff';
                    phoneField.style.border = '2px solid #27ae60';
                    console.log('üìß Populated phone field:', currentUser.phone);
                }
                
                // Add a helpful message for the user
                const formSection = document.querySelector('.contact-form-section h2');
                if (formSection && !document.getElementById('autoPopulateNotice')) {
                    const notice = document.createElement('p');
                    notice.id = 'autoPopulateNotice';
                    notice.style.cssText = 'color: #27ae60; font-size: 0.9rem; margin: 0.5rem 0; font-style: italic;';
                    notice.textContent = `‚úÖ Form auto-populated with your account information (${currentUser.name})`;
                    formSection.insertAdjacentElement('afterend', notice);
                }
                
                return currentUser;
            } else {
                console.log('‚ùå No user session found for contact form');
                
                // Clear auto-populated styling if user logs out
                if (nameField && nameField.style.backgroundColor === 'rgb(240, 248, 255)') {
                    nameField.value = '';
                    nameField.style.backgroundColor = '';
                    nameField.style.border = '';
                }
                if (emailField && emailField.style.backgroundColor === 'rgb(240, 248, 255)') {
                    emailField.value = '';
                    emailField.style.backgroundColor = '';
                    emailField.style.border = '';
                }
                if (phoneField && phoneField.style.backgroundColor === 'rgb(240, 248, 255)') {
                    phoneField.value = '';
                    phoneField.style.backgroundColor = '';
                    phoneField.style.border = '';
                }
                
                // Remove auto-populate notice
                const notice = document.getElementById('autoPopulateNotice');
                if (notice) {
                    notice.remove();
                }
                
                return null;
            }
        }
        
        // Initialize auto-populate when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üìß Contact page loaded, checking for user session...');
            
            // Wait a bit for session managers to load
            setTimeout(() => {
                checkUserSessionForContact();
            }, 300);
            
            // Listen for authentication events
            window.addEventListener('userAuthChanged', (event) => {
                console.log('üìß User authentication changed, refreshing contact form');
                setTimeout(checkUserSessionForContact, 100);
            });
            
            window.addEventListener('userLoggedOut', () => {
                console.log('üìß User logged out, clearing contact form');
                setTimeout(checkUserSessionForContact, 100);
            });
        });
        
        // Simple Contact form handling - localStorage only
        document.getElementById('contactForm')?.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Get form data
            const formData = new FormData(this);
            const data = Object.fromEntries(formData);
            
            // Simple validation
            if (!data.name || !data.email || !data.message || !data.subject) {
                alert('Please fill in all required fields.');
                return;
            }
            
            // Show loading state
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalText = submitBtn.textContent;
            submitBtn.textContent = 'Sending...';
            submitBtn.disabled = true;
            
            // Prepare message data
            const messageData = {
                name: data.name,
                email: data.email,
                phone: data.phone || 'Not provided',
                subject: data.subject,
                message: data.message,
                timestamp: new Date().toLocaleString(),
                id: Date.now() // Simple ID for tracking
            };
            
            // Save to localStorage
            saveContactMessage(messageData);
            
            // Show success message
            setTimeout(() => {
                alert('Thank you for your message! We\'ve received it and will get back to you within 24 hours.');
                document.getElementById('contactForm').reset();
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }, 1000);
        });
        
        // Save contact messages to localStorage
        function saveContactMessage(messageData) {
            try {
                let messages = JSON.parse(localStorage.getItem('contactMessages') || '[]');
                messages.push(messageData);
                localStorage.setItem('contactMessages', JSON.stringify(messages));
                console.log('Contact message saved:', messageData);
                
                // Dispatch custom event for admin panel
                window.dispatchEvent(new CustomEvent('contactMessageAdded', { detail: messageData }));
            } catch (error) {
                console.error('Failed to save contact message:', error);
            }
        }
        
        // Function to get all contact messages (for admin panel)
        window.getContactMessages = function() {
            try {
                return JSON.parse(localStorage.getItem('contactMessages') || '[]');
            } catch (error) {
                console.error('Failed to load contact messages:', error);
                return [];
            }
        };
    </script>
</body>
</html>