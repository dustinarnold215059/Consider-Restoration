<!DOCTYPE html>
<html>
<head>
    <title>Cross-Page Session Test</title>
    <script>
        console.log('HTML page loading...');
        window.addEventListener('load', function() {
            console.log('Page load event fired');
            console.log('CookieSessionManager available:', typeof window.CookieSessionManager);
        });
    </script>
    <script src="js/cookie-session-manager.js" onerror="console.error('Failed to load cookie-session-manager.js')" onload="console.log('cookie-session-manager.js loaded successfully')"></script>
</head>
<body>
    <h1>Cross-Page Session Test</h1>
    <nav>
        <a href="index.html">Home</a> | 
        <a href="about.html">About</a> | 
        <a href="services.html">Services</a> | 
        <a href="user-portal.html" id="accountNavLink">Login</a> | 
        <span id="adminNavLink" style="display: none;">Admin</span>
    </nav>
    
    <h2>Quick Login Test</h2>
    <button onclick="quickLogin()">Quick Login as Test User</button>
    <button onclick="checkStatus()">Check Login Status</button>
    <button onclick="quickLogout()">Logout</button>
    
    <div id="status" style="margin-top: 20px; padding: 10px; background: #f0f0f0;">
        Status will appear here...
    </div>
    
    <h3>Instructions:</h3>
    <ol>
        <li>Click "Quick Login as Test User"</li>
        <li>Notice the navigation should change from "Login" to "My Account"</li>
        <li>Navigate to another page (Home, About, Services)</li>
        <li>Check if the navigation still shows "My Account" on the other page</li>
    </ol>

    <script>
        function log(message) {
            const statusDiv = document.getElementById('status');
            const time = new Date().toLocaleTimeString();
            statusDiv.innerHTML += `<div>[${time}] ${message}</div>`;
            console.log(message);
        }
        
        function quickLogin() {
            log('Attempting quick login...');
            const testUser = {
                id: 'test-user-123',
                name: 'Test User',
                email: 'testuser@test.com',
                role: 'client'
            };
            
            if (window.CookieSessionManager) {
                const success = window.CookieSessionManager.login(testUser);
                log(`Login result: ${success}`);
                
                setTimeout(() => {
                    const currentUser = window.CookieSessionManager.getCurrentUser();
                    log(`Current user after login: ${currentUser ? currentUser.name : 'None'}`);
                    
                    // Check navigation update
                    const accountLink = document.getElementById('accountNavLink');
                    log(`Navigation text: "${accountLink.textContent}"`);
                }, 500);
                
            } else {
                log('ERROR: CookieSessionManager not available');
            }
        }
        
        function checkStatus() {
            log('Checking current session status...');
            if (window.CookieSessionManager) {
                const user = window.CookieSessionManager.getCurrentUser();
                const isLoggedIn = window.CookieSessionManager.isLoggedIn();
                
                log(`Is logged in: ${isLoggedIn}`);
                log(`Current user: ${user ? user.name + ' (' + user.email + ')' : 'None'}`);
                
                const accountLink = document.getElementById('accountNavLink');
                log(`Navigation shows: "${accountLink.textContent}"`);
                
                // Check cookies
                const cookies = document.cookie;
                log(`Cookies: ${cookies || 'None'}`);
                
            } else {
                log('ERROR: CookieSessionManager not available');
            }
        }
        
        function quickLogout() {
            log('Logging out...');
            if (window.CookieSessionManager) {
                window.CookieSessionManager.logout();
                log('Logout completed');
                
                setTimeout(() => {
                    const accountLink = document.getElementById('accountNavLink');
                    log(`Navigation after logout: "${accountLink.textContent}"`);
                }, 500);
                
            } else {
                log('ERROR: CookieSessionManager not available');
            }
        }
        
        // Initialize when page loads
        setTimeout(() => {
            log('Page loaded - checking initial state...');
            if (window.CookieSessionManager) {
                log('✅ CookieSessionManager is available');
                checkStatus();
            } else {
                log('❌ CookieSessionManager not available yet, waiting...');
                setTimeout(() => {
                    if (window.CookieSessionManager) {
                        log('✅ CookieSessionManager now available');
                        checkStatus();
                    } else {
                        log('❌ CookieSessionManager still not available');
                    }
                }, 2000);
            }
        }, 1000);
    </script>
</body>
</html>