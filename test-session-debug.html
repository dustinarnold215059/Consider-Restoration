<!DOCTYPE html>
<html>
<head>
    <title>Session Debug Test</title>
    <script src="js/cookie-session-manager.js"></script>
</head>
<body>
    <h1>Session Debug Test</h1>
    <div id="status"></div>
    <div id="navigation">
        <span id="accountNavLink">Login</span> | 
        <span id="adminNavLink" style="display: none;">Admin</span>
    </div>
    
    <div id="advanced-tests">
        <h3>Advanced Tests</h3>
        <button onclick="testCrossPageNavigation()">Test Navigation Update</button>
        <button onclick="clearAllData()">Clear All Data</button>
    </div>
    
    <button onclick="testLogin()">Test Login</button>
    <button onclick="checkSession()">Check Session</button>
    <button onclick="testLogout()">Test Logout</button>
    <button onclick="checkCookies()">Check Cookies</button>

    <script>
        let statusDiv = document.getElementById('status');
        
        function log(message) {
            console.log(message);
            statusDiv.innerHTML += '<div>' + message + '</div>';
        }
        
        function testLogin() {
            log('Testing login...');
            const testUser = {
                id: 'test123',
                name: 'Test User',
                email: 'test@test.com',
                role: 'client'
            };
            
            if (window.CookieSessionManager) {
                const success = window.CookieSessionManager.login(testUser);
                log('Login result: ' + success);
                log('Current user: ' + JSON.stringify(window.CookieSessionManager.getCurrentUser()));
            } else {
                log('ERROR: CookieSessionManager not found!');
            }
        }
        
        function checkSession() {
            log('Checking session...');
            if (window.CookieSessionManager) {
                const user = window.CookieSessionManager.getCurrentUser();
                log('Current user: ' + (user ? JSON.stringify(user) : 'No user'));
                log('Is logged in: ' + window.CookieSessionManager.isLoggedIn());
            } else {
                log('ERROR: CookieSessionManager not found!');
            }
        }
        
        function testLogout() {
            log('Testing logout...');
            if (window.CookieSessionManager) {
                window.CookieSessionManager.logout();
                log('Logout completed');
            } else {
                log('ERROR: CookieSessionManager not found!');
            }
        }
        
        function checkCookies() {
            log('All cookies: ' + document.cookie);
        }
        
        function testCrossPageNavigation() {
            log('Testing navigation update...');
            if (window.CookieSessionManager) {
                window.CookieSessionManager.updateNavigation();
                log('Navigation update called');
                log('Account link text: ' + document.getElementById('accountNavLink').textContent);
                log('Admin link display: ' + document.getElementById('adminNavLink').style.display);
            }
        }
        
        function clearAllData() {
            log('Clearing all session data...');
            // Clear cookies
            document.cookie.split(";").forEach(function(c) { 
                document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/"); 
            });
            // Clear localStorage
            localStorage.clear();
            // Clear sessionStorage
            sessionStorage.clear();
            log('All data cleared');
        }
        
        // Check if session manager loaded
        setTimeout(() => {
            log('Session manager available: ' + (window.CookieSessionManager ? 'YES' : 'NO'));
            if (window.CookieSessionManager) {
                log('Session manager initialized: ' + window.CookieSessionManager.initialized);
            }
        }, 1000);
    </script>
</body>
</html>